# AI 音源分离方案架构设计 (Experimental)

本文档记录了关于引入 AI 音源分离（Audio Source Separation）的技术方案讨论、硬件决策及未来实施路线。

---

## 1. 核心目标
实现“音乐透明化”，通过 AI 将混成一团的音频拆分为独立声部（人声、鼓点、钢琴等），从而在视觉上实现不同乐器对应不同的烟火特效。

## 2. 技术决策

### 2.1 方案选型：异构计算与分布式部署
- **决策内容**：前端（React/Static Hosting）与 AI 计算后端（GPU Machine）分离。
- **理由**：
    - 浏览器端直接运行 AI 复杂度极高，且对普通用户设备压力巨大。
    - 将计算负载卸载到配备专用显卡的后端，可保证 10-20 秒内完成高品质解析。

### 2.2 模型选择：Demucs (Meta AI Research)
- **决策内容**：采用开源的 **Demucs v4** 模型（如 `htdemucs_ft`）。
- **理由**：
    - 完全开源，无单次解析费用。
    - 在 2026 年仍属于行业顶尖水平，人声与背景音分离最干净。
    - 能够直接输出 Vocals, Drums, Bass, Other 四条独立音轨。

### 2.3 硬件选型：RTX 4060 8G
- **决策内容**：在后端部署 RTX 4060 等级别的显卡。
- **理由**：
    - **显存**：8GB VRAM 足以容纳 Demucs 推理阶段（约 4GB）的开销。
    - **性能**：Ada Lovelace 架构能提供极快的计算速度，保证用户无需死等。

## 3. 架构流程 (Workflow)

1. **上传**：Web 前端通过 API 向后端提交 MP3 文件。
2. **异步任务**：后端 (FastAPI) 接收任务并放入队列，分发给 4060 显卡执行 `demucs` 推理。
3. **返回**：处理完成后，后端返回 4 个 Stem 文件的地址。
4. **渲染**：前端 `FireworkEngine` 同时驱动四个分析器，实现多声部视觉对齐。

## 4. 视觉映射规范 (未来预留)
- **人声 (Vocals)** -> 金色流光烟火。
- **鼓点 (Drums)** -> 高频红色爆发火花。
- **贝斯 (Bass)** -> 底部紫色震动场。
- **旋律 (Other)** -> 浮动音符粒子。

---
*注：本方案目前处于设计验证阶段，后续将启动 API 端点对接。*

## 5. 核心理念：从“文件驱动”转向“数据驱动” (Data-Driven Animation)

在将音频转化为视觉艺术（如数字烟花）时，核心在于**数据驱动**。我们不需要完整的 50MB 音频文件，而是需要从中提取出的高精度、轻量化的“特征数据点”。

### 5.1 为什么选择数据驱动？
| 维度 | 方案 A：直接读取音频 (File-Driven) | 方案 B：导出简化数据 (Data-Driven) |
| :--- | :--- | :--- |
| **处理方式** | 在渲染循环中实时进行 FFT 变换。 | 预先提取各轨道的振幅峰值、节拍点等特征。 |
| **性能** | 占用内存高，多音轨同步时易掉帧。 | 运行极快，数据文件极小（仅几百 KB）。 |
| **冗余度** | 包含大量人耳听觉相关的冗余信息。 | 只提取瞬态、包络等视觉强相关信息。 |

### 5.2 核心数据规格 (The "Firework Potion")
从 Demucs 的输出中，我们将利用 **Python + librosa** 提取以下“烟花药水”数据：

- **瞬态触发 (Transients)**：由 **Drums** 轨道提取。通过检测鼓点的 Onset（起始点），记录精确的时间戳，用于触发烟花的**发射点**。
- **频率包络 (Envelopes)**：由 **Vocals** 轨道提取 RMS 能量。控制烟花爆炸中心的**核心亮度与光晕强度**。
- **低频能量 (Sub-energy)**：由 **Bass** 轨道提取。低频能量的大小直接映射为烟花的**爆炸半径与粒子散开范围**。
- **频谱密度 (FFT Density)**：由 **Other** 轨道提取。利用中高频活跃度动态切换粒子的**尾迹颜色与形态**。

## 6. 推荐技术栈与实施路线

### 6.1 预处理阶段 (Python Backend)
- **工具链**：Python + `librosa` (特征提取) -> 导出为 `.json`。
- **硬件**：RTX 4060 充分发挥并行计算能力，在分离音轨的同时完成特征点计算。

### 6.2 视觉渲染阶段 (Frontend/Engine)
- **p5.js / Canvas API**：适合在 Web 端实现自定义的高性能粒子系统。
- **数据加载**：前端仅加载数百 KB 的 JSON 特征文件，实现精准的时间轴同步。
- **未来扩展**：随着 4060 显卡性能的发挥，可考虑引入 Unity/Unreal 进行 3D 粒子渲染，配合光线追踪实现顶级烟花质感。
